<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15">
<title></title>
<base href="<%- baseUrl %>">
<script src="/socket.io/socket.io.js"></script>
<script src="static/js/jquery/dist/jquery.js"></script>
<script src="static/js/jquery-qrcode/jquery.qrcode.min.js"></script>
<script src="static/js/bitcore-lib/bitcore-lib.js"></script>
<style>
body {
  font-family: Ubuntu;
  text-align: center;
  transition: background-color 1s;
}
h1 {
  font-weight:200;
  font-size:48px;
}
h2 {
  font-weight:200;
  font-size:32px;
}
#balance {
  margin-top:40px;
  font-size:48px;
}
</style>
<script language="javascript">
  $(document).ready(function() {
    var bitcore = require('bitcore-lib');
    var socket = io('http://localhost:3001');
    var hashes = {};
    socket.on('address/balance', function(address, balance, block) {
      $('#balance').text(balance / 1e8+ 'BTC');
    });
    socket.on('address/transaction', function(txInfo) {
      var tx = bitcore.Transaction(txInfo.tx);
      var hash = tx.hash;
      if (!hashes[hash]) {
        $('body').css('background-color', '#d7eaa2');
        setTimeout(function() {
          $('body').css('background-color', '#fff');
        }, 1000);
        $('#coins')[0].play();
      }
    });
    socket.emit('subscribe', 'address/balance', ['<%- receivingAddress %>']);
    socket.emit('subscribe', 'address/transaction', ['<%- receivingAddress %>']);
    $('#qrcode').qrcode('bitcoin:<%- receivingAddress %>?amount=0.01');
  });
</script>
</head>

<body>
  <h1><%- receivingAddress %></h1>
  <div id="qrcode"></div>
  <div id="balance"></div>
  <audio id="coins" src="static/coins.wav"></audio>
</body>
</html>
